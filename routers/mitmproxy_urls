#!/bin/bash

echo 'def request(ctx, flow):' > mitmproxy_script.py
echo '    f = open("/tmp/mitmproxy_output", "a+")' >> mitmproxy_script.py
echo '    f.write("%s\n" % flow.request.get_url())' >> mitmproxy_script.py
echo '    f.close()' >> mitmproxy_script.py
echo '' >> mitmproxy_script.py
echo 'def response(ctx, flow):' >> mitmproxy_script.py
echo '    f = open("/tmp/mitmproxy_output", "a+")' >> mitmproxy_script.py
echo '    f.write("%s\n" % flow.request.get_url())' >> mitmproxy_script.py
echo '    f.close()' >> mitmproxy_script.py

mitmproxy -w /tmp/mitmproxy_dump
mitmproxy -q -s mitmproxy_script.py -r /tmp/mitmproxy_dump
rm mitmproxy_script.py
rm /tmp/mitmproxy_dump
sleep 1
echo -e "\n\n\n"
cat /tmp/mitmproxy_output | sort | uniq | tee mitmproxy_output
echo -e "\n\n\n"
rm /tmp/mitmproxy_output
